<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ヘンダーソンの14の基本的ニーズ - 看護実習チェックリスト</title>
    <style>
        :root {
            --primary: #8B4A9C;
            --primary-light: #A569BD;
            --primary-dark: #7D3C98;
            --secondary: #BB8FCE;
            --accent: #D2B4DE;
            --accent-light: #E8DAEF;
            --warning: #F1948A;
            --success: #58D68D;
            --bg: #FDEDEC;
            --card-bg: #FFFFFF;
            --white: #FFFFFF;
            --text-primary: #4A4A4A;
            --text-secondary: #6C6C6C;
            --text-light: #999999;
            --border: #E6E6FA;
            --shadow: rgba(139, 74, 156, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Kaku Gothic Pro', 'ヒラギノ角ゴ Pro W3', Meiryo, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app-container {
            max-width: 428px;
            margin: 0 auto;
            background: var(--card-bg);
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 30px var(--shadow);
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 24px 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .header h1 {
            font-size: 19px;
            font-weight: 700;
            margin-bottom: 6px;
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 13px;
            opacity: 0.9;
            font-weight: 400;
        }

        .progress-section {
            background: var(--white);
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .progress-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .progress-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .progress-bar {
            background: var(--bg);
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 12px;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--primary) 0%, var(--success) 100%);
            height: 100%;
            transition: width 0.4s ease;
            border-radius: 5px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .controls {
            padding: 20px;
            background: var(--white);
            border-bottom: 1px solid var(--border);
        }

        .control-group {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            box-shadow: 0 4px 15px var(--shadow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg);
            border-color: var(--primary);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--warning) 0%, #EC7063 100%);
            color: var(--white);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
        }

        .feature-toggles {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
        }

        .toggle-info {
            flex: 1;
        }

        .toggle-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .toggle-desc {
            font-size: 11px;
            color: var(--text-light);
        }

        .switch {
            position: relative;
            width: 48px;
            height: 26px;
            background: var(--border);
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .switch.active {
            background: var(--primary);
        }

        .switch::before {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: var(--white);
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .switch.active::before {
            transform: translateX(22px);
        }

        .disease-selector {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .disease-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .disease-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .disease-btn {
            padding: 8px 12px;
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .disease-btn.active {
            background: var(--primary-light);
            border-color: var(--primary);
            color: var(--white);
            font-weight: 600;
        }

        .disease-btn:hover {
            border-color: var(--primary);
        }

        .patterns-container {
            padding: 20px;
            padding-bottom: 120px;
        }

        .info-banner {
            background: linear-gradient(135deg, var(--accent-light) 0%, #F4ECF7 100%);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent);
        }

        .info-banner h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-banner p {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .pattern-card {
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 16px;
            margin-bottom: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px var(--shadow);
            transition: all 0.3s ease;
            position: relative;
        }

        .pattern-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px var(--shadow);
        }

        .pattern-card.completed {
            border-color: var(--success);
            box-shadow: 0 4px 20px rgba(88, 214, 141, 0.3);
        }

        .pattern-card.highlighted {
            border-color: var(--warning);
            background: linear-gradient(135deg, #FEF9F9 0%, #FDEBEB 100%);
        }

        .pattern-card.completed::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--success) 0%, var(--accent) 100%);
        }

        .pattern-header {
            padding: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--white);
            position: relative;
        }

        .pattern-card.completed .pattern-header {
            background: linear-gradient(135deg, #F8FDF9 0%, #F1FCF3 100%);
        }

        .pattern-title {
            display: flex;
            align-items: center;
            gap: 14px;
            flex: 1;
        }

        .pattern-number {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
            box-shadow: 0 3px 10px var(--shadow);
        }

        .pattern-card.completed .pattern-number {
            background: linear-gradient(135deg, var(--success) 0%, var(--accent) 100%);
        }

        .pattern-card.highlighted .pattern-number {
            background: linear-gradient(135deg, var(--warning) 0%, #EC7063 100%);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pattern-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.3;
        }

        .pattern-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .highlight-badge {
            background: var(--warning);
            color: var(--white);
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
            margin-right: 4px;
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .checkbox.checked {
            background: linear-gradient(135deg, var(--success) 0%, var(--accent) 100%);
            border-color: var(--success);
            color: var(--white);
            transform: scale(1.1);
        }

        .expand-icon {
            font-size: 18px;
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .pattern-card.expanded .expand-icon {
            transform: rotate(90deg);
            color: var(--primary);
        }

        .pattern-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .pattern-card.expanded .pattern-content {
            max-height: 3000px;
        }

        .pattern-detail {
            padding: 0 20px 24px;
            border-top: 1px solid var(--border);
            background: linear-gradient(180deg, #FEFEFD 0%, var(--white) 100%);
        }

        .detail-section {
            margin-bottom: 20px;
            padding-top: 16px;
        }

        .detail-title {
            font-weight: 700;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
        }

        .detail-title .emoji {
            font-size: 16px;
        }

        .detail-content {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .assessment-points {
            list-style: none;
        }

        .assessment-points li {
            position: relative;
            padding: 8px 0 8px 20px;
            margin-bottom: 4px;
            background: var(--card-bg);
            border-radius: 8px;
            padding: 10px 10px 10px 30px;
            border-left: 3px solid var(--accent);
        }

        .assessment-points li::before {
            content: '●';
            position: absolute;
            left: 12px;
            color: var(--accent);
            font-weight: bold;
            font-size: 12px;
        }

        .question-list {
            background: linear-gradient(135deg, var(--primary-light) 0%, #BB8FCE 100%);
            border-radius: 12px;
            padding: 16px;
        }

        .question-list p {
            font-size: 13px;
            margin-bottom: 8px;
            padding: 12px;
            background: var(--white);
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            box-shadow: 0 2px 8px rgba(139, 74, 156, 0.1);
        }

        .question-list p:last-child {
            margin-bottom: 0;
        }

        .soap-example {
            background: linear-gradient(135deg, #F8F4F9 0%, #F4ECF7 100%);
            border-radius: 12px;
            padding: 16px;
            border-left: 4px solid var(--secondary);
            box-shadow: 0 2px 10px rgba(187, 143, 206, 0.1);
        }

        .soap-item {
            margin-bottom: 10px;
            font-size: 12px;
            line-height: 1.4;
        }

        .soap-item:last-child {
            margin-bottom: 0;
        }

        .soap-label {
            font-weight: 700;
            color: var(--secondary);
            display: inline-block;
            width: 22px;
            font-size: 13px;
        }

        .nursing-diagnosis {
            background: linear-gradient(135deg, #F9F4FA 0%, #F6EDF8 100%);
            border-radius: 10px;
            padding: 14px;
            margin-top: 12px;
            border-left: 4px solid var(--accent);
        }

        .nursing-diagnosis h4 {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .nursing-diagnosis p {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .floating-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }

        .floating-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 20px var(--shadow);
            transition: all 0.3s ease;
            border: none;
        }

        .floating-btn:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 8px 30px var(--shadow);
        }

        .floating-notes {
            background: linear-gradient(135deg, var(--secondary) 0%, #A569BD 100%);
        }

        .floating-help {
            background: linear-gradient(135deg, var(--accent) 0%, #BB8FCE 100%);
            font-size: 18px;
        }

        .notes-modal, .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(74, 74, 74, 0.7);
            display: none;
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .notes-modal.show, .help-modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            width: 90%;
            max-width: 420px;
            max-height: 85vh;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(74, 74, 74, 0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--white);
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .modal-body {
            padding: 24px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .notes-textarea {
            width: 100%;
            height: 200px;
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            font-size: 14px;
            resize: vertical;
            font-family: inherit;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: border-color 0.2s;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 74, 156, 0.1);
        }

        .help-content h3 {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .help-content p, .help-content li {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .help-content ul {
            padding-left: 16px;
            margin-bottom: 16px;
        }

        .toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--success) 0%, var(--accent) 100%);
            color: var(--white);
            padding: 16px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            opacity: 0;
            transition: all 0.4s ease;
            z-index: 3000;
            box-shadow: 0 8px 30px rgba(88, 214, 141, 0.4);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        @media (max-width: 480px) {
            .app-container {
                border-radius: 0;
            }
            
            .header {
                padding: 20px;
            }
            
            .patterns-container {
                padding: 16px;
            }
            
            .pattern-header {
                padding: 16px;
            }
            
            .pattern-detail {
                padding: 0 16px 20px;
            }
            
            .floating-buttons {
                bottom: 16px;
                right: 16px;
            }
        }

        .sakura-animation {
            animation: sakuraFall 3s ease-in-out;
        }

        @keyframes sakuraFall {
            0% { transform: translateY(-50px) rotate(0deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(50px) rotate(360deg); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>ヘンダーソンの14の基本的ニーズ</h1>
            <p>ヴァージニア・ヘンダーソン | 看護実習アセスメントアプリ</p>
        </div>

        <div class="progress-section">
            <div class="progress-header">
                <div class="progress-title">
                    <span>📊</span>学習進捗
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-text">
                <span id="progressText">0 / 14 完了</span>
                <span id="progressPercent">0%</span>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <button class="btn btn-primary" onclick="expandAll()">📖 全て展開</button>
                <button class="btn btn-secondary" onclick="collapseAll()">📝 全て閉じる</button>
                <button class="btn btn-danger" onclick="resetAll()">🔄 リセット</button>
            </div>
            
            <div class="feature-toggles">
                <div class="toggle-row">
                    <div class="toggle-info">
                        <div class="toggle-title">📚 学習モード</div>
                        <div class="toggle-desc">SOAP例文と看護診断を表示</div>
                    </div>
                    <div class="switch" id="studyModeSwitch" onclick="toggleStudyMode()"></div>
                </div>
                
                <div class="toggle-row">
                    <div class="toggle-info">
                        <div class="toggle-title">🏥 疾患別ガイド</div>
                        <div class="toggle-desc">選択した疾患で重要なニーズをハイライト</div>
                    </div>
                    <div class="switch" id="diseaseGuideSwitch" onclick="toggleDiseaseGuide()"></div>
                </div>
            </div>

            <div class="disease-selector" id="diseaseSelector" style="display: none;">
                <div class="disease-title">🔍 対象疾患を選択</div>
                <div class="disease-grid">
                    <div class="disease-btn" onclick="selectDisease('heart_failure')">心不全</div>
                    <div class="disease-btn" onclick="selectDisease('diabetes')">糖尿病</div>
                    <div class="disease-btn" onclick="selectDisease('stroke')">脳梗塞</div>
                    <div class="disease-btn" onclick="selectDisease('pneumonia')">肺炎</div>
                    <div class="disease-btn" onclick="selectDisease('depression')">うつ病</div>
                    <div class="disease-btn" onclick="selectDisease('dementia')">認知症</div>
                </div>
            </div>
        </div>

        <div class="patterns-container" id="patternsContainer">
            <div class="info-banner">
                <h3>🌸 使い方のヒント</h3>
                <p>ヘンダーソンの14の基本的ニーズで、患者さんの全人的な理解を深めましょう。「できること」と「支援が必要なこと」を分けて観察することが大切です！</p>
            </div>
        </div>

        <div class="floating-buttons">
            <button class="floating-btn floating-help" onclick="openHelp()" title="使い方">❓</button>
            <button class="floating-btn floating-notes" onclick="openNotes()" title="実習メモ">📝</button>
        </div>

        <div class="notes-modal" id="notesModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">📝 実習メモ</h3>
                    <button class="close-btn" onclick="closeNotes()">×</button>
                </div>
                <div class="modal-body">
                    <textarea class="notes-textarea" id="notesTextarea" placeholder="患者さんの基本的ニーズや気づいたこと、実習での学びをメモしてください...&#10;&#10;例：&#10;・〇〇さん（心不全）：呼吸ニーズに支援が必要、酸素療法中&#10;・栄養ニーズ：塩分制限の理解が不十分&#10;・コミュニケーションニーズ：積極的、質問多い"></textarea>
                </div>
            </div>
        </div>

        <div class="help-modal" id="helpModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">❓ ヘンダーソンの基本的ニーズについて</h3>
                    <button class="close-btn" onclick="closeHelp()">×</button>
                </div>
                <div class="modal-body">
                    <div class="help-content">
                        <h3>🌸 ヘンダーソンの14の基本的ニーズとは</h3>
                        <p>ヴァージニア・ヘンダーソンによって提唱された、人間が人間らしく生きるために必要な14の基本的要素です。「20世紀の看護の母」と呼ばれる彼女の理論は、世界中の看護教育で活用されています。</p>

                        <h3>📊 14のニーズ構成</h3>
                        <ul>
                            <li><strong>生理的ニーズ（1-9）：</strong>呼吸、栄養、排泄、運動、睡眠、衣類、体温、清潔、安全</li>
                            <li><strong>心理社会的ニーズ（10-14）：</strong>コミュニケーション、信仰、仕事、遊び、学習</li>
                        </ul>

                        <h3>🎯 理論の特徴</h3>
                        <ul>
                            <li><strong>ウェルネス志向：</strong>問題だけでなく「できること」も重視</li>
                            <li><strong>全人的理解：</strong>身体・心理・社会面を総合的に評価</li>
                            <li><strong>自立支援：</strong>患者の自立を促進することが目標</li>
                            <li><strong>基本的人間ニーズ：</strong>すべての人に共通する普遍的ニーズ</li>
                        </ul>

                        <h3>📝 実習での活用方法</h3>
                        <ul>
                            <li>14項目をチェックリストとして情報収集</li>
                            <li>「できること」と「支援が必要なこと」を明確に分ける</li>
                            <li>患者の強みを活かした看護計画の立案</li>
                            <li>全人的な視点での患者理解とケア提供</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="toast" id="toast"></div>
    </div>

    <script>
        const basicNeeds = [
            // 生理的ニーズ（1-9）
            {
                id: 1,
                name: "正常に呼吸する",
                category: "生理的ニーズ",
                description: "酸素供給と炭酸ガス排出の基本的機能の評価",
                assessmentPoints: [
                    "呼吸数、リズム、深度の観察",
                    "呼吸音の聴診と異常音の確認",
                    "SpO₂値、動脈血ガス分析結果",
                    "呼吸困難感、チアノーゼの有無",
                    "咳嗽、喀痰の性状と量"
                ],
                questions: [
                    "息苦しさを感じることはありますか？",
                    "階段を上る時に息が切れますか？",
                    "夜間、息苦しくて目が覚めることはありますか？",
                    "痰は出ますか？どんな色ですか？",
                    "タバコを吸ったことはありますか？"
                ],
                soapExample: {
                    s: "「少し動くだけで息が苦しくなります」",
                    o: "呼吸数28回/分、SpO₂ 90%（room air）、労作性呼吸困難あり",
                    a: "心不全による呼吸ニーズの充足困難、酸素化不良の状態",
                    p: "安楽な体位の確保、酸素療法継続、活動制限の必要性を説明"
                },
                nursingDiagnosis: "非効果的呼吸パターン：心不全による肺うっ血に関連した"
            },
            {
                id: 2,
                name: "適切に飲食する",
                category: "生理的ニーズ",
                description: "栄養と水分摂取による生命維持機能の評価",
                assessmentPoints: [
                    "食事摂取量、摂取パターン、嗜好",
                    "体重変化、栄養状態の評価",
                    "嚥下機能、咀嚼能力の確認",
                    "消化器症状（嘔気、嘔吐、下痢等）",
                    "血液検査値（Alb、TP、Hb等）"
                ],
                questions: [
                    "食欲はいかがですか？",
                    "好きな食べ物、嫌いな食べ物はありますか？",
                    "普段の食事時間と量を教えてください",
                    "飲み込みにくいと感じることはありますか？",
                    "最近体重の変化はありましたか？"
                ],
                soapExample: {
                    s: "「糖尿病の食事制限が難しくて、つい甘いものを食べてしまいます」",
                    o: "HbA1c 8.5%、BMI 28.5、食事療法への理解不足あり",
                    a: "糖尿病管理における栄養ニーズの充足困難、食事療法の理解不足",
                    p: "栄養士と連携した個別指導、血糖自己測定の教育を実施"
                },
                nursingDiagnosis: "栄養摂取不足：疾患管理に関する知識不足に関連した"
            },
            {
                id: 3,
                name: "あらゆる排泄経路から排泄する",
                category: "生理的ニーズ",
                description: "老廃物の適切な排出機能の評価",
                assessmentPoints: [
                    "排尿・排便の回数、量、性状",
                    "排泄パターンと規則性",
                    "尿意・便意の感覚の有無",
                    "失禁の有無とコントロール状況",
                    "排泄に関連する症状や困難"
                ],
                questions: [
                    "排便の回数や便の硬さはいかがですか？",
                    "排尿の回数や量に変化はありますか？",
                    "排泄時に痛みや違和感はありますか？",
                    "夜間、トイレに起きる回数は何回ですか？",
                    "便秘や下痢の傾向はありますか？"
                ],
                soapExample: {
                    s: "「3日間排便がなく、お腹が張って苦しいです」",
                    o: "腹部膨満感あり、最終排便3日前、水分摂取量少ない",
                    a: "便秘による排泄ニーズの充足困難、水分摂取不足が要因",
                    p: "緩下剤使用、水分摂取促進、腹部マッサージを実施"
                },
                nursingDiagnosis: "便秘：水分摂取不足と活動量低下に関連した"
            },
            {
                id: 4,
                name: "身体の位置を動かし、またよい姿勢を保持する",
                category: "生理的ニーズ",
                description: "運動と姿勢保持による身体機能の維持評価",
                assessmentPoints: [
                    "ADLの自立度と移動能力",
                    "筋力、関節可動域の状態",
                    "バランス機能、歩行能力",
                    "体位変換の頻度と方法",
                    "活動制限の要因と程度"
                ],
                questions: [
                    "普段どのくらい体を動かしていますか？",
                    "歩行や移動で困ることはありますか？",
                    "関節の痛みやこわばりはありますか？",
                    "転倒した経験はありますか？",
                    "どのような運動や活動をしていますか？"
                ],
                soapExample: {
                    s: "「右手足が動かしにくくて、一人で歩くのが不安です」",
                    o: "右片麻痺、歩行時ふらつきあり、杖歩行レベル",
                    a: "脳梗塞後遺症による活動・運動ニーズの充足困難",
                    p: "理学療法士と連携、安全な移動方法の指導、転倒予防策を実施"
                },
                nursingDiagnosis: "身体運動機能障害：脳梗塞による片麻痺に関連した"
            },
            {
                id: 5,
                name: "睡眠と休息をとる",
                category: "生理的ニーズ",
                description: "疲労回復と心身の再生機能の評価",
                assessmentPoints: [
                    "睡眠時間、睡眠の質",
                    "入眠・覚醒パターン",
                    "睡眠中断の頻度と原因",
                    "日中の眠気、疲労感",
                    "睡眠環境と睡眠習慣"
                ],
                questions: [
                    "何時頃寝て、何時頃起きますか？",
                    "眠りの深さや質はいかがですか？",
                    "夜中に目が覚めることはありますか？",
                    "日中に眠気を感じますか？",
                    "リラックスして眠るために何かしていますか？"
                ],
                soapExample: {
                    s: "「病院の音が気になって、夜中に何度も目が覚めます」",
                    o: "入眠困難、中途覚醒3-4回/夜、日中の軽度倦怠感あり",
                    a: "環境変化による睡眠・休息ニーズの充足困難",
                    p: "睡眠環境の調整、リラクゼーション法の指導、睡眠パターンの評価"
                },
                nursingDiagnosis: "睡眠パターン混乱：環境変化に関連した"
            },
            {
                id: 6,
                name: "適当な衣類を選び、着脱する",
                category: "生理的ニーズ",
                description: "保護と自己表現のための衣類管理能力の評価",
                assessmentPoints: [
                    "着脱動作の自立度",
                    "衣類選択の判断力",
                    "身だしなみへの関心度",
                    "季節や場面に応じた衣類選択",
                    "身体機能制限の影響"
                ],
                questions: [
                    "普段、衣類の着脱で困ることはありますか？",
                    "好きな服装やこだわりはありますか？",
                    "季節に合わせて衣類を選べますか？",
                    "ボタンやファスナーの操作はできますか？",
                    "身だしなみを整えることは大切だと思いますか？"
                ],
                soapExample: {
                    s: "「右手が使いにくくて、ボタンをかけるのが大変です」",
                    o: "右片麻痺により巧緻動作困難、着衣に一部介助が必要",
                    a: "片麻痺による衣類着脱ニーズの充足困難",
                    p: "自助具の紹介、片手で着脱しやすい衣類の選択を指導"
                },
                nursingDiagnosis: "セルフケア不足（更衣）：片麻痺による巧緻動作障害に関連した"
            },
            {
                id: 7,
                name: "衣類の調節と環境の調整により、体温を生理的範囲内に維持する",
                category: "生理的ニーズ",
                description: "体温調節機能と環境適応能力の評価",
                assessmentPoints: [
                    "体温の測定値と変動",
                    "発熱の有無と対処",
                    "環境温度への適応状況",
                    "衣類や寝具による体温調節",
                    "体温調節に関する自己管理"
                ],
                questions: [
                    "暑さや寒さを普通に感じますか？",
                    "体温調節のために何かしていますか？",
                    "発熱時はどのように対処しますか？",
                    "室温の調整はできますか？",
                    "汗をかきやすい方ですか？"
                ],
                soapExample: {
                    s: "「この部屋は寒すぎます。毛布をもう一枚ください」",
                    o: "体温36.2℃、室温22℃設定、患者は寒がりを訴える",
                    a: "個人差による体温調節ニーズへの対応が必要",
                    p: "室温調整と寝具の追加、患者の体温調節の好みを把握"
                },
                nursingDiagnosis: "体温調節効果的：個人の快適性維持に関連した"
            },
            {
                id: 8,
                name: "身体を清潔に保ち、身だしなみを整え、皮膚を保護する",
                category: "生理的ニーズ",
                description: "清潔保持と感染予防、皮膚統合性の評価",
                assessmentPoints: [
                    "全身の清潔状態",
                    "皮膚の状態と統合性",
                    "清潔ケアの自立度",
                    "感染予防への理解と実践",
                    "身だしなみへの関心と能力"
                ],
                questions: [
                    "普段の入浴やシャワーの頻度は？",
                    "体を洗うことで困ることはありますか？",
                    "皮膚にかゆみや乾燥はありますか？",
                    "口腔ケアは毎日していますか？",
                    "手洗いやうがいの習慣はありますか？"
                ],
                soapExample: {
                    s: "「糖尿病で足の傷が治りにくいと言われています」",
                    o: "足趾間に軽度発赤、乾燥肌著明、フットケアの知識不足",
                    a: "糖尿病による皮膚ケアニーズの充足困難、感染リスクあり",
                    p: "フットケア指導、皮膚保湿の重要性を説明、定期的な観察"
                },
                nursingDiagnosis: "皮膚統合性障害リスク状態：糖尿病による循環障害に関連した"
            },
            {
                id: 9,
                name: "環境のさまざまな危険因子を避け、また他人を傷害しないようにする",
                category: "生理的ニーズ",
                description: "安全確保と事故予防能力の評価",
                assessmentPoints: [
                    "環境の危険因子の認識",
                    "転倒・転落リスクの評価",
                    "感染予防対策の実践",
                    "薬物管理の安全性",
                    "他者への配慮と安全意識"
                ],
                questions: [
                    "自宅や周囲で危険だと感じることはありますか？",
                    "転倒した経験はありますか？",
                    "薬の管理で困ることはありますか？",
                    "感染予防で気をつけていることは？",
                    "他の人に迷惑をかけないよう気をつけていることは？"
                ],
                soapExample: {
                    s: "「夜中にトイレに起きる時、足元がふらつくことがあります」",
                    o: "夜間頻尿、起立時軽度めまい、居室に段差あり",
                    a: "転倒リスクによる安全ニーズの充足困難",
                    p: "夜間照明の設置、ポータブルトイレの使用検討、転倒予防指導"
                },
                nursingDiagnosis: "転倒リスク状態：夜間頻尿と起立性低血圧に関連した"
            },

            // 心理社会的ニーズ（10-14）
            {
                id: 10,
                name: "自分の感情、欲求、恐怖あるいは\"気分\"を表現して他者とのコミュニケーションをもつ",
                category: "心理社会的ニーズ",
                description: "感情表現とコミュニケーション能力の評価",
                assessmentPoints: [
                    "感情表現の方法と頻度",
                    "コミュニケーション能力",
                    "対人関係の質",
                    "言語・非言語的表現",
                    "社会的交流の状況"
                ],
                questions: [
                    "気持ちを人に話すことはありますか？",
                    "困った時に相談できる人はいますか？",
                    "家族や友人との関係はいかがですか？",
                    "自分の気持ちをうまく表現できますか？",
                    "人と話すことは好きですか？"
                ],
                soapExample: {
                    s: "「家族に心配をかけたくなくて、本当の気持ちを言えません」",
                    o: "表情暗く、家族面会時も遠慮がちな様子、感情表出少ない",
                    a: "遠慮により感情表現・コミュニケーションニーズの充足困難",
                    p: "患者の気持ちを傾聴、家族との関係調整、感情表出を促進"
                },
                nursingDiagnosis: "社会的相互作用障害：家族への遠慮に関連した"
            },
            {
                id: 11,
                name: "自分の信仰に従って礼拝する",
                category: "心理社会的ニーズ",
                description: "スピリチュアルニーズと価値観の評価",
                assessmentPoints: [
                    "宗教的信仰の有無と内容",
                    "価値観や人生観",
                    "スピリチュアルな習慣",
                    "信念に基づく生活",
                    "精神的支えの存在"
                ],
                questions: [
                    "信仰している宗教はありますか？",
                    "大切にしている価値観や信念はありますか？",
                    "人生で最も大切だと思うことは何ですか？",
                    "精神的な支えになるものはありますか？",
                    "お祈りや瞑想をすることはありますか？"
                ],
                soapExample: {
                    s: "「仏教徒なので、できるだけ肉類は避けたいです」",
                    o: "仏教の信仰あり、菜食を希望、朝夕にお経を読む習慣",
                    a: "宗教的信念に基づく信仰ニーズの充足を希望",
                    p: "宗教的配慮を行い、可能な範囲で菜食メニューを提供、静寂時間を確保"
                },
                nursingDiagnosis: "スピリチュアル苦痛リスク状態：入院による宗教的習慣の制限に関連した"
            },
            {
                id: 12,
                name: "達成感をもたらすような仕事をする",
                category: "心理社会的ニーズ",
                description: "生産的活動と自己実現の評価",
                assessmentPoints: [
                    "職業や役割への満足度",
                    "達成感や充実感の有無",
                    "社会的貢献への意識",
                    "仕事や役割の継続可能性",
                    "自己効力感の状態"
                ],
                questions: [
                    "現在のお仕事や役割にやりがいを感じますか？",
                    "家庭や社会で担っている役割はありますか？",
                    "達成感を感じる活動はありますか？",
                    "病気で仕事や役割に変化がありましたか？",
                    "将来の仕事や役割についてどう考えますか？"
                ],
                soapExample: {
                    s: "「長期入院で仕事を休んでいて、職場に迷惑をかけて申し訳ない」",
                    o: "教師として働く、生徒を想う気持ちが強い、復職への焦りあり",
                    a: "休職による仕事・役割ニーズの充足困難、罪責感を抱いている",
                    p: "患者の価値観を尊重、段階的復職計画の相談、ソーシャルワーカー紹介"
                },
                nursingDiagnosis: "役割遂行障害：疾患による休職に関連した"
            },
            {
                id: 13,
                name: "遊び、あるいはさまざまな種類のレクリエーションに参加する",
                category: "心理社会的ニーズ",
                description: "娯楽と気分転換、ストレス発散の評価",
                assessmentPoints: [
                    "趣味や娯楽活動の有無",
                    "レクリエーションへの参加意欲",
                    "気分転換の方法",
                    "楽しみや喜びの表現",
                    "他者との交流機会"
                ],
                questions: [
                    "趣味や好きなことはありますか？",
                    "普段の楽しみは何ですか？",
                    "気分転換のために何をしますか？",
                    "病院でも楽しめることはありますか？",
                    "他の患者さんとお話しすることはありますか？"
                ],
                soapExample: {
                    s: "「編み物が好きだったけど、手の震えで細かい作業ができません」",
                    o: "パーキンソン病による手指振戦、従来の趣味継続困難、表情に寂しさ",
                    a: "疾患による遊び・レクリエーションニーズの充足困難",
                    p: "新しい趣味の提案、音楽鑑賞や読書等の代替活動を検討"
                },
                nursingDiagnosis: "レクリエーション参加障害：手指振戦による巧緻動作困難に関連した"
            },
            {
                id: 14,
                name: "正常な発達および健康を導くような学習をし、発見をし、あるいは好奇心を満足させる",
                category: "心理社会的ニーズ",
                description: "学習と成長、知的好奇心の評価",
                assessmentPoints: [
                    "学習意欲と能力",
                    "新しい知識への関心",
                    "疾患・治療への理解度",
                    "自己管理能力の習得",
                    "知的好奇心の表現"
                ],
                questions: [
                    "新しいことを学ぶのは好きですか？",
                    "自分の病気について知りたいと思いますか？",
                    "治療方法や薬について質問がありますか？",
                    "退院後の生活で学んでおきたいことはありますか？",
                    "普段、本を読んだりニュースを見たりしますか？"
                ],
                soapExample: {
                    s: "「糖尿病のことをもっと詳しく知って、自分で管理できるようになりたい」",
                    o: "疾患への理解意欲が高い、質問が多い、メモを取りながら説明を聞く",
                    a: "疾患管理に関する学習ニーズが高く、積極的な姿勢",
                    p: "個別教育プログラムの実施、患者教育パンフレットの提供、理解度確認"
                },
                nursingDiagnosis: "学習準備状態：疾患管理への関心の高さに関連した"
            }
        ];

        // 疾患別重要パターンの定義
        const diseasePatterns = {
            heart_failure: [1, 2, 4, 5, 9],      // 心不全：呼吸、栄養、活動、休息、安全
            diabetes: [2, 8, 12, 14],            // 糖尿病：栄養、清潔、仕事、学習
            stroke: [1, 3, 4, 10, 12],           // 脳梗塞：呼吸、排泄、活動、コミュニケーション、仕事
            pneumonia: [1, 2, 5, 8, 9],          // 肺炎：呼吸、栄養、休息、清潔、安全
            depression: [10, 11, 12, 13, 14],    // うつ病：コミュニケーション、信仰、仕事、遊び、学習
            dementia: [4, 8, 9, 10, 13]          // 認知症：活動、清潔、安全、コミュニケーション、遊び
        };

        let completedPatterns = new Set();
        let expandedPatterns = new Set();
        let studyMode = false;
        let diseaseGuideMode = false;
        let selectedDisease = '';

        function initializeApp() {
            renderPatterns();
            updateProgress();
            loadSavedData();
        }

        function renderPatterns() {
            const container = document.getElementById('patternsContainer');
            const existingBanner = container.querySelector('.info-banner');
            container.innerHTML = '';
            
            if (existingBanner) {
                container.appendChild(existingBanner);
            }

            basicNeeds.forEach(need => {
                const isCompleted = completedPatterns.has(need.id);
                const isExpanded = expandedPatterns.has(need.id);
                const isHighlighted = diseaseGuideMode && selectedDisease && 
                    diseasePatterns[selectedDisease] && diseasePatterns[selectedDisease].includes(need.id);
                
                const patternCard = document.createElement('div');
                patternCard.className = `pattern-card ${isCompleted ? 'completed' : ''} ${isExpanded ? 'expanded' : ''} ${isHighlighted ? 'highlighted' : ''}`;
                patternCard.innerHTML = `
                    <div class="pattern-header" onclick="togglePattern(${need.id})">
                        <div class="pattern-title">
                            <div class="pattern-number">${need.id}</div>
                            <div class="pattern-name">
                                ${isHighlighted ? '<span class="highlight-badge">重要</span>' : ''}
                                ${need.name}
                                <div style="font-size: 11px; color: var(--text-light); font-weight: 400; margin-top: 2px;">
                                    ${need.category}
                                </div>
                            </div>
                        </div>
                        <div class="pattern-status">
                            <div class="checkbox ${isCompleted ? 'checked' : ''}" onclick="event.stopPropagation(); toggleComplete(${need.id})">
                                ${isCompleted ? '✓' : ''}
                            </div>
                            <div class="expand-icon">▶</div>
                        </div>
                    </div>
                    <div class="pattern-content">
                        <div class="pattern-detail">
                            ${studyMode ? `
                            <div class="detail-section">
                                <div class="detail-title"><span class="emoji">📖</span>基本的ニーズの説明</div>
                                <div class="detail-content">${need.description}</div>
                            </div>
                            ` : ''}
                            
                            <div class="detail-section">
                                <div class="detail-title"><span class="emoji">🎯</span>アセスメントのポイント</div>
                                <ul class="assessment-points">
                                    ${need.assessmentPoints.map(point => `<li>${point}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="detail-section">
                                <div class="detail-title"><span class="emoji">💬</span>患者さんへの質問例</div>
                                <div class="question-list">
                                    ${need.questions.map(q => `<p>${q}</p>`).join('')}
                                </div>
                            </div>
                            
                            ${studyMode ? `
                            <div class="detail-section">
                                <div class="detail-title"><span class="emoji">📋</span>SOAP記録例</div>
                                <div class="soap-example">
                                    <div class="soap-item"><span class="soap-label">S:</span> ${need.soapExample.s}</div>
                                    <div class="soap-item"><span class="soap-label">O:</span> ${need.soapExample.o}</div>
                                    <div class="soap-item"><span class="soap-label">A:</span> ${need.soapExample.a}</div>
                                    <div class="soap-item"><span class="soap-label">P:</span> ${need.soapExample.p}</div>
                                </div>
                                ${need.nursingDiagnosis ? `
                                <div class="nursing-diagnosis">
                                    <h4><span class="emoji">🏥</span>看護診断例</h4>
                                    <p>${need.nursingDiagnosis}</p>
                                </div>
                                ` : ''}
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                container.appendChild(patternCard);
            });
        }

        function togglePattern(id) {
            if (expandedPatterns.has(id)) {
                expandedPatterns.delete(id);
            } else {
                expandedPatterns.add(id);
            }
            renderPatterns();
            saveData();
        }

        function toggleComplete(id) {
            if (completedPatterns.has(id)) {
                completedPatterns.delete(id);
                showToast('チェックを外しました 📝');
            } else {
                completedPatterns.add(id);
                showToast('基本的ニーズを完了しました！ 🌸');
            }
            renderPatterns();
            updateProgress();
            saveData();
        }

        function updateProgress() {
            const total = basicNeeds.length;
            const completed = completedPatterns.size;
            const percentage = Math.round((completed / total) * 100);
            
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${completed} / ${total} 完了`;
            document.getElementById('progressPercent').textContent = percentage + '%';
            
            if (completed === total) {
                // 桜のアニメーション効果
                document.body.classList.add('sakura-animation');
                setTimeout(() => {
                    document.body.classList.remove('sakura-animation');
                }, 3000);
                showToast('🌸🎉 全ニーズ完了！実習お疲れ様でした！ 🎉🌸');
            }
        }

        function expandAll() {
            basicNeeds.forEach(need => expandedPatterns.add(need.id));
            renderPatterns();
            saveData();
            showToast('全て展開しました 📖');
        }

        function collapseAll() {
            expandedPatterns.clear();
            renderPatterns();
            saveData();
            showToast('全て閉じました 📝');
        }

        function resetAll() {
            if (confirm('全ての進捗をリセットしてもよろしいですか？\n（メモは保持されます）')) {
                completedPatterns.clear();
                expandedPatterns.clear();
                renderPatterns();
                updateProgress();
                saveData();
                showToast('🔄 進捗をリセットしました');
            }
        }

        function toggleStudyMode() {
            studyMode = !studyMode;
            const switchElement = document.getElementById('studyModeSwitch');
            switchElement.classList.toggle('active', studyMode);
            renderPatterns();
            saveData();
            showToast(studyMode ? '📚 学習モードON - SOAP例文を表示' : '📱 シンプルモードON');
        }

        function toggleDiseaseGuide() {
            diseaseGuideMode = !diseaseGuideMode;
            const switchElement = document.getElementById('diseaseGuideSwitch');
            const selector = document.getElementById('diseaseSelector');
            
            switchElement.classList.toggle('active', diseaseGuideMode);
            selector.style.display = diseaseGuideMode ? 'block' : 'none';
            
            if (!diseaseGuideMode) {
                selectedDisease = '';
                document.querySelectorAll('.disease-btn').forEach(btn => btn.classList.remove('active'));
            }
            
            renderPatterns();
            saveData();
            showToast(diseaseGuideMode ? '🏥 疾患別ガイドON' : '📱 通常モードON');
        }

        function selectDisease(disease) {
            selectedDisease = selectedDisease === disease ? '' : disease;
            
            document.querySelectorAll('.disease-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (selectedDisease) {
                document.querySelector(`[onclick="selectDisease('${disease}')"]`).classList.add('active');
                const diseaseNames = {
                    heart_failure: '心不全',
                    diabetes: '糖尿病',
                    stroke: '脳梗塞',
                    pneumonia: '肺炎',
                    depression: 'うつ病',
                    dementia: '認知症'
                };
                showToast(`🔍 ${diseaseNames[selectedDisease]}の重要ニーズをハイライト`);
            }
            
            renderPatterns();
            saveData();
        }

        function openNotes() {
            document.getElementById('notesModal').classList.add('show');
            const notes = localStorage.getItem('hendersonNotes') || '';
            document.getElementById('notesTextarea').value = notes;
            document.getElementById('notesTextarea').focus();
        }

        function closeNotes() {
            const notes = document.getElementById('notesTextarea').value;
            localStorage.setItem('hendersonNotes', notes);
            document.getElementById('notesModal').classList.remove('show');
            showToast('💾 メモを保存しました');
        }

        function openHelp() {
            document.getElementById('helpModal').classList.add('show');
        }

        function closeHelp() {
            document.getElementById('helpModal').classList.remove('show');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3500);
        }

        function saveData() {
            const data = {
                completed: Array.from(completedPatterns),
                expanded: Array.from(expandedPatterns),
                studyMode: studyMode,
                diseaseGuideMode: diseaseGuideMode,
                selectedDisease: selectedDisease
            };
            localStorage.setItem('hendersonData', JSON.stringify(data));
        }

        function loadSavedData() {
            const savedData = localStorage.getItem('hendersonData');
            if (savedData) {
                const data = JSON.parse(savedData);
                completedPatterns = new Set(data.completed || []);
                expandedPatterns = new Set(data.expanded || []);
                studyMode = data.studyMode || false;
                diseaseGuideMode = data.diseaseGuideMode || false;
                selectedDisease = data.selectedDisease || '';
                
                document.getElementById('studyModeSwitch').classList.toggle('active', studyMode);
                document.getElementById('diseaseGuideSwitch').classList.toggle('active', diseaseGuideMode);
                document.getElementById('diseaseSelector').style.display = diseaseGuideMode ? 'block' : 'none';
                
                if (selectedDisease) {
                    document.querySelector(`[onclick="selectDisease('${selectedDisease}')"]`)?.classList.add('active');
                }
                
                renderPatterns();
                updateProgress();
            }
        }

        // モーダル外クリックで閉じる
        document.getElementById('notesModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeNotes();
            }
        });

        document.getElementById('helpModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeHelp();
            }
        });

        // 初期化
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>